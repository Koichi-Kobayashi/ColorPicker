<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="clr-namespace:ColorPicker.Converter"
    xmlns:local="clr-namespace:ColorPicker.Controls">

    <converter:ColorWithAlphaConverter x:Key="ColorWithAlphaConverter" />
    <converter:ColorToHexConverter x:Key="ColorToHexConverter" />
    <converter:ColorAlphaBlendConverter x:Key="ColorAlphaBlendConverter" />
    <converter:ColorAlphaBlendToHexMultiConverter x:Key="ColorAlphaBlendToHexMultiConverter" />
    <converter:PaletteToolTipTextConverter x:Key="PaletteToolTipTextConverter" />

    <!--
        =========================
        Helpers: Checker brush
        =========================
    -->
    <DrawingBrush
        x:Key="CheckerBrush"
        TileMode="Tile"
        Viewbox="0,0,16,16"
        ViewboxUnits="Absolute"
        Viewport="0,0,16,16"
        ViewportUnits="Absolute">
        <DrawingBrush.Drawing>
            <DrawingGroup>
                <!--  base  -->
                <GeometryDrawing Brush="#FFFFFFFF" Geometry="M 0,0 L 16,0 16,16 0,16 Z" />
                <!--  dark tiles  -->
                <GeometryDrawing Brush="#FFE6E6E6" Geometry="M 0,0 L 8,0 8,8 0,8 Z" />
                <GeometryDrawing Brush="#FFE6E6E6" Geometry="M 8,8 L 16,8 16,16 8,16 Z" />
            </DrawingGroup>
        </DrawingBrush.Drawing>
    </DrawingBrush>

    <!--
        =========================
        Hue rainbow brush
        =========================
    -->
    <LinearGradientBrush x:Key="HueRainbowBrush" StartPoint="0,0.5" EndPoint="1,0.5">
        <!--  0..360 をぐるっと  -->
        <GradientStop Offset="0.00" Color="#FFFF0000" />
        <GradientStop Offset="0.17" Color="#FFFFFF00" />
        <GradientStop Offset="0.33" Color="#FF00FF00" />
        <GradientStop Offset="0.50" Color="#FF00FFFF" />
        <GradientStop Offset="0.67" Color="#FF0000FF" />
        <GradientStop Offset="0.83" Color="#FFFF00FF" />
        <GradientStop Offset="1.00" Color="#FFFF0000" />
    </LinearGradientBrush>

    <Style x:Key="PaletteSwatchButtonStyle" TargetType="{x:Type Button}">
        <Setter Property="Width" Value="44" />
        <Setter Property="Height" Value="34" />
        <Setter Property="Margin" Value="6,6,0,0" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border Background="{TemplateBinding Background}" CornerRadius="6">
                        <Border.Effect>
                            <DropShadowEffect
                                BlurRadius="6"
                                Opacity="0.15"
                                ShadowDepth="0" />
                        </Border.Effect>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Opacity" Value="0.9" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter Property="Opacity" Value="0.75" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Opacity" Value="0.5" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--  thumb style (WinUIっぽい輪っか)  -->
    <Style x:Key="RingThumbStyle" TargetType="{x:Type Thumb}">
        <Setter Property="Width" Value="18" />
        <Setter Property="Height" Value="18" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Thumb}">
                    <Grid>
                        <Ellipse Fill="#CCFFFFFF" />
                        <Ellipse
                            Margin="2"
                            Fill="Transparent"
                            Stroke="#CC000000"
                            StrokeThickness="1" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--
        =========================
        WinUI-like Slider Thumb
        =========================
    -->

    <Style x:Key="WinUIRoundThumbStyle" TargetType="{x:Type Thumb}">
        <Setter Property="Width" Value="18" />
        <Setter Property="Height" Value="18" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Thumb}">
                    <Grid SnapsToDevicePixels="True">
                        <!--  shadow (simple)  -->
                        <Ellipse Margin="0,1,0,0" Opacity="0.18">
                            <Ellipse.Fill>
                                <SolidColorBrush Color="#000000" />
                            </Ellipse.Fill>
                            <Ellipse.Effect>
                                <DropShadowEffect
                                    BlurRadius="8"
                                    Opacity="0.35"
                                    ShadowDepth="1" />
                            </Ellipse.Effect>
                        </Ellipse>

                        <!--  knob  -->
                        <Ellipse
                            Fill="#FFFFFFFF"
                            Stroke="#22000000"
                            StrokeThickness="1" />
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Width" Value="18" />
                            <Setter Property="Height" Value="18" />
                        </Trigger>
                        <Trigger Property="IsDragging" Value="True">
                            <Setter Property="Width" Value="20" />
                            <Setter Property="Height" Value="20" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Opacity" Value="0.5" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--
        =========================
        WinUI-like Slider (transparent track, our thumb)
        =========================
    -->
    <Style x:Key="WinUISliderStyle" TargetType="{x:Type Slider}">
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="IsMoveToPointEnabled" Value="True" />
        <Setter Property="Focusable" Value="False" />
        <Setter Property="Height" Value="22" />

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Slider}">
                    <Grid Height="{TemplateBinding Height}">
                        <Track
                            x:Name="PART_Track"
                            Margin="10,0,10,0"
                            VerticalAlignment="Center"
                            IsDirectionReversed="{TemplateBinding IsDirectionReversed}">

                            <!--  クリックを受ける必要があるので IsHitTestVisible は消す  -->
                            <Track.DecreaseRepeatButton>
                                <RepeatButton
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Command="Slider.DecreaseLarge"
                                    Focusable="False"
                                    Opacity="0" />
                            </Track.DecreaseRepeatButton>

                            <Track.IncreaseRepeatButton>
                                <RepeatButton
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Command="Slider.IncreaseLarge"
                                    Focusable="False"
                                    Opacity="0" />
                            </Track.IncreaseRepeatButton>

                            <Track.Thumb>
                                <Thumb Style="{StaticResource WinUIRoundThumbStyle}" />
                            </Track.Thumb>
                        </Track>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--
        =========================
        ColorPicker Template
        =========================
    -->
    <Style TargetType="{x:Type local:ColorPicker}">
        <Setter Property="Focusable" Value="True" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:ColorPicker}">
                    <Grid Margin="4">
                        <Grid.RowDefinitions>
                            <!--  0: Spectrum  -->
                            <RowDefinition Height="Auto" />
                            <!--  1  -->
                            <RowDefinition Height="12" />
                            <!--  2: Hue  -->
                            <RowDefinition Height="Auto" />
                            <!--  3  -->
                            <RowDefinition Height="12" />
                            <!--  4: Palette  -->
                            <RowDefinition Height="Auto" />
                            <!--  5  -->
                            <RowDefinition Height="16" />
                            <!--  6: Alpha  -->
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!--  Spectrum (S/V plane)  -->
                        <Border
                            Grid.Row="0"
                            Background="#0C000000"
                            BorderBrush="#22000000"
                            BorderThickness="1"
                            CornerRadius="10"
                            SnapsToDevicePixels="True">
                            <Grid>
                                <Canvas
                                    x:Name="PART_SpectrumCanvas"
                                    MinWidth="240"
                                    MinHeight="180">
                                    <Image
                                        x:Name="PART_SpectrumImage"
                                        SnapsToDevicePixels="True"
                                        Stretch="Fill" />

                                    <Thumb x:Name="PART_SpectrumThumb" Style="{StaticResource RingThumbStyle}" />
                                </Canvas>
                            </Grid>
                        </Border>

                        <!--  Hue slider (rainbow track)  -->
                        <Grid Grid.Row="2" VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="42" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="54" />
                                <!--  RGB (#RRGGBB)  -->
                                <ColumnDefinition Width="90" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                Grid.Column="0"
                                VerticalAlignment="Center"
                                Opacity="0.75"
                                Text="Hue" />

                            <Grid
                                Grid.Column="1"
                                Height="22"
                                Margin="8,0,0,0"
                                VerticalAlignment="Center">
                                <!--  rainbow track behind slider  -->
                                <Border
                                    Background="{StaticResource HueRainbowBrush}"
                                    BorderBrush="#22000000"
                                    BorderThickness="1"
                                    CornerRadius="6" />

                                <Slider
                                    x:Name="PART_HueSlider"
                                    Margin="2"
                                    VerticalAlignment="Center"
                                    Background="Transparent"
                                    IsMoveToPointEnabled="True"
                                    Maximum="360"
                                    Minimum="0"
                                    Style="{StaticResource WinUISliderStyle}"
                                    Value="{TemplateBinding Hue}" />
                            </Grid>

                            <TextBlock
                                Grid.Column="2"
                                Margin="8,0,0,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Opacity="0.75"
                                Text="{Binding Hue, RelativeSource={RelativeSource TemplatedParent}, StringFormat={}{0:0}}" />

                            <!--  RGB (#RRGGBB)  -->
                            <TextBox
                                Grid.Column="3"
                                Height="22"
                                Margin="8,0,0,0"
                                Padding="8,0"
                                VerticalContentAlignment="Center"
                                local:TextBoxSelectAllBehavior.SelectAllOnFocus="True"
                                Background="#0C000000"
                                BorderBrush="#22000000"
                                BorderThickness="1"
                                FontFamily="Consolas"
                                IsReadOnly="True"
                                Text="{Binding SelectedColor, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ColorToHexConverter}, ConverterParameter=RGB}" />

                        </Grid>

                        <!--  Palette (between Hue and Alpha)  -->
                        <ItemsControl
                            x:Name="PART_PaletteItems"
                            Grid.Row="4"
                            Margin="42,8,0,0"
                            ItemsSource="{Binding PaletteColors, RelativeSource={RelativeSource TemplatedParent}}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Columns="8" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button
                                        x:Name="PART_PaletteSwatchButton"
                                        Style="{StaticResource PaletteSwatchButtonStyle}"
                                        Tag="{Binding}">
                                        <Button.ToolTip>
                                            <MultiBinding Converter="{StaticResource PaletteToolTipTextConverter}">
                                                <Binding />
                                                <!--  PaletteColor  -->
                                                <Binding Path="ToolTipLanguage" RelativeSource="{RelativeSource AncestorType={x:Type local:ColorPicker}}" />
                                            </MultiBinding>
                                        </Button.ToolTip>

                                        <Button.Background>
                                            <SolidColorBrush Color="{Binding Color}" />
                                        </Button.Background>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!--  Alpha slider (checker + alpha gradient overlay)  -->
                        <Grid Grid.Row="6" VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="42" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="54" />
                                <!--  RGB (#RRGGBB)  -->
                                <ColumnDefinition Width="90" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                Grid.Column="0"
                                VerticalAlignment="Center"
                                Opacity="0.75"
                                Text="A" />

                            <Grid
                                Grid.Column="1"
                                Height="22"
                                Margin="8,0,0,0"
                                VerticalAlignment="Center">
                                <Border
                                    Background="{StaticResource CheckerBrush}"
                                    BorderBrush="#22000000"
                                    BorderThickness="1"
                                    CornerRadius="6" />

                                <!--  overlay: transparent -> selectedColor(opaque)  -->
                                <Border Margin="1" CornerRadius="6">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0.5" EndPoint="1,0.5">
                                            <GradientStop Offset="0" Color="{Binding SelectedColor, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ColorWithAlphaConverter}, ConverterParameter=0}" />
                                            <GradientStop Offset="1" Color="{Binding SelectedColor, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ColorWithAlphaConverter}, ConverterParameter=255}" />
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>


                                <Slider
                                    x:Name="PART_AlphaSlider"
                                    Margin="2"
                                    VerticalAlignment="Center"
                                    Background="Transparent"
                                    IsMoveToPointEnabled="True"
                                    Maximum="1"
                                    Minimum="0"
                                    Style="{StaticResource WinUISliderStyle}"
                                    Value="{TemplateBinding Alpha}" />
                            </Grid>

                            <!--  Preview (checker + selected color)  -->
                            <Border
                                Grid.Column="2"
                                Width="44"
                                Height="22"
                                Margin="8,0,0,0"
                                Background="{StaticResource CheckerBrush}"
                                BorderBrush="#22000000"
                                BorderThickness="1"
                                CornerRadius="6">
                                <Border Margin="1" CornerRadius="6">
                                    <Border.Background>
                                        <SolidColorBrush Color="{Binding SelectedColor, RelativeSource={RelativeSource TemplatedParent}}" />
                                    </Border.Background>
                                </Border>
                            </Border>

                            <!--  RGBA (#AARRGGBB)  -->
                            <TextBox
                                Grid.Column="3"
                                Height="22"
                                Margin="6,0,0,0"
                                Padding="8,0"
                                VerticalContentAlignment="Center"
                                local:TextBoxSelectAllBehavior.SelectAllOnFocus="True"
                                Background="#0C000000"
                                BorderBrush="#22000000"
                                BorderThickness="1"
                                FontFamily="Consolas"
                                IsReadOnly="True"
                                Text="{Binding SelectedColor, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ColorToHexConverter}}" />
                        </Grid>

                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>
